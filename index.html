<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞ÑÂáªÊ∏∏ÊàèÔºàÂ∏¶ÂçáÁ∫ßÁ≥ªÁªüÔºâ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            text-align: center;
        }

        canvas {
            display: block;
            background: #222;
        }

        #score,
        #exp,
        #level {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        #exp {
            top: 40px;
            font-size: 20px;
        }

        #level {
            top: 70px;
            font-size: 20px;
        }

        #joystick-container {
            position: fixed;
            bottom: 50px;
            left: 50px;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }

        #joystick {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            position: absolute;
        }

        #shootBtn {
            position: fixed;
            bottom: 50px;
            right: 50px;
            width: 80px;
            height: 80px;
            background: red;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            touch-action: none;
        }

        #shootBtn:active {
            background: darkred;
        }

        #upgradePanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            color: white;
            text-align: center;
            border-radius: 10px;
            display: none;
        }

        #upgradePanel button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            font-size: 18px;
            background: white;
            border: none;
            cursor: pointer;
        }

        #upgradePanel button:hover {
            background: lightgray;
        }

        /* Êñ∞Â¢ûÁöÑÊõ¥Â§öÊåâÈíÆÂèäËèúÂçïÊ†∑Âºè */
        #moreBtn {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #moreMenu {
            position: fixed;
            top: 70px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        #moreMenu button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 5px;
            background: white;
            border: none;
            cursor: pointer;
        }

        #moreMenu button:hover {
            background: lightgray;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">ÂæóÂàÜ: 0</div>
    <div id="exp">ÁªèÈ™å: 0/100</div>
    <div id="level">Á≠âÁ∫ß: 1</div>
    <div id="joystick-container"><div id="joystick"></div></div>
    <button id="shootBtn">üî´</button>
    <div id="upgradePanel">
        <h2>ÈÄâÊã©‰Ω†ÁöÑÂçáÁ∫ß</h2>
        <button id="upgrade1"></button>
        <button id="upgrade2"></button>
        <button id="upgrade3"></button>
    </div>
    <!-- Êñ∞Â¢ûÁöÑÊõ¥Â§öÊåâÈíÆÂèäËèúÂçï -->
    <button id="moreBtn">Êõ¥Â§ö</button>
    <div id="moreMenu">
        <button id="missMeBtn">‰Ω†ÊÉ≥Êàë‰∫ÜÂêó</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0, level = 1, exp = 0, expNeeded = 100;
        let experienceMultiplier = 1; // Ë∑üË∏™ÁªèÈ™åÂÄçÊï∞
        let player = { x: canvas.width / 2, y: canvas.height - 80, width: 50, height: 50, speed: 8, color: "blue" };
        let enemies = [], bullets = [], bulletSpeed = 6, cooldown = 500, lastShotTime = 0;
        let tripleShotChosen = false; // Ë∑üË∏™‰∏âÈáçÂ∞ÑÂáªÊòØÂê¶Â∑≤Ë¢´ÈÄâÊã©

        function spawnEnemy() {
            let size = 40, x = Math.random() * (canvas.width - size);
            enemies.push({ x, y: 0, width: size, height: size, speed: 3, color: "red" });
        }

        function update() {
            enemies.forEach((enemy, i) => { enemy.y += enemy.speed; if (enemy.y > canvas.height) enemies.splice(i, 1); });
            bullets.forEach((bullet, bi) => {
                bullet.y -= bullet.speed;
                if (bullet.y < 0) bullets.splice(bi, 1);
                enemies.forEach((enemy, ei) => {
                    if (bullet.x < enemy.x + enemy.width && bullet.x + bullet.width > enemy.x && bullet.y < enemy.y + enemy.height && bullet.y + bullet.height > enemy.y) {
                        enemies.splice(ei, 1); bullets.splice(bi, 1);
                        score++;
                        let earnedExp = 10 * experienceMultiplier; // Ê†πÊçÆÂÄçÊï∞Ëé∑ÂæóÁªèÈ™å
                        exp += earnedExp;
                        document.getElementById("score").innerText = "ÂæóÂàÜ: " + score;
                        document.getElementById("exp").innerText = `ÁªèÈ™å: ${exp}/${expNeeded}`;
                        checkLevelUp();
                    }
                });
            });
            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            enemies.forEach(enemy => { ctx.fillStyle = enemy.color; ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height); });
            bullets.forEach(bullet => { ctx.fillStyle = "white"; ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height); });
        }

        function gameLoop() { update(); requestAnimationFrame(gameLoop); }
        setInterval(spawnEnemy, 1000);
        gameLoop();

        function checkLevelUp() {
            if (exp >= expNeeded) {
                exp -= expNeeded; level++; expNeeded += 50;
                document.getElementById("level").innerText = `Á≠âÁ∫ß: ${level}`;
                showUpgradeOptions();
            }
        }

        function showUpgradeOptions() {
            document.getElementById("upgradePanel").style.display = "block";
            let upgrades = [
                { name: "ÁßªÂä®ÈÄüÂ∫¶ +1", effect: () => player.speed++ },
                { name: "Â≠êÂºπÈÄüÂ∫¶ +1", effect: () => bulletSpeed++ },
                { name: "ÂáèÂ∞ëÂ∞ÑÂáªÂÜ∑Âç¥", effect: () => cooldown = Math.max(200, cooldown - 100) },
                { name: "ÂèåÂÄçÁªèÈ™å", effect: () => { experienceMultiplier *= 2; } } // ÊØèÊ¨°ÈÄâÊã©ÔºåÁªèÈ™åÂÄçÊï∞‰πò‰ª• 2
            ];

            // Âú®Á¨¨5Á∫ßÊó∂Êñ∞Â¢û‰∏âÈáçÂ∞ÑÂáªÈÄâÈ°π
            if (level >= 5 &&!tripleShotChosen) {
                upgrades.push({ name: "‰∏âÈáçÂ∞ÑÂáª", effect: () => {
                    bulletSpeed += 2;
                    bulletSpeed = Math.max(bulletSpeed, 6);
                    tripleShotChosen = true;
                } });
            }

            let choices = [];
            while (choices.length < 3) {
                let rand = upgrades[Math.floor(Math.random() * upgrades.length)];
                if (!choices.includes(rand)) choices.push(rand);
            }

            choices.forEach((choice, index) => {
                let button = document.getElementById(`upgrade${index + 1}`);
                button.innerText = choice.name;
                button.onclick = () => {
                    choice.effect();
                    document.getElementById("upgradePanel").style.display = "none";
                    document.getElementById("exp").innerText = `ÁªèÈ™å: ${exp}/${expNeeded}`;
                };
            });
        }

        // Ëß¶Êë∏ÊéßÂà∂ - ÊëáÊùÜ
        let joystick = document.getElementById("joystick");
        let joystickContainer = document.getElementById("joystick-container");
        let joystickCenterX = joystickContainer.offsetLeft + joystickContainer.offsetWidth / 2;
        let moveDir = 0;

        joystickContainer.addEventListener("touchstart", (event) => {
            event.preventDefault();
            let touch = event.touches[0];
            moveJoystick(touch.clientX, touch.clientY);
        });

        joystickContainer.addEventListener("touchmove", (event) => {
            event.preventDefault();
            let touch = event.touches[0];
            moveJoystick(touch.clientX, touch.clientY);
        });

        joystickContainer.addEventListener("touchend", () => {
            joystick.style.left = "25px";
            joystick.style.top = "25px";
            moveDir = 0;
        });

        function moveJoystick(touchX, touchY) {
            let dx = touchX - joystickCenterX;
            if (dx > 20) {
                moveDir = 1;  // ÂêëÂè≥
                joystick.style.left = "50px";
            } else if (dx < -20) {
                moveDir = -1; // ÂêëÂ∑¶
                joystick.style.left = "0px";
            } else {
                moveDir = 0;
                joystick.style.left = "25px";
            }
        }

        function movePlayer() {
            if (moveDir === -1 && player.x > 0) {
                player.x -= player.speed;
            } else if (moveDir === 1 && player.x + player.width < canvas.width) {
                player.x += player.speed;
            }
            requestAnimationFrame(movePlayer);
        }
        movePlayer();

        // Ëß¶Êë∏Â∞ÑÂáªÊåâÈíÆ
        document.getElementById("shootBtn").addEventListener("touchstart", () => {
            let now = Date.now();
            if (now - lastShotTime > cooldown) {
                lastShotTime = now;
                let bullet = { x: player.x + player.width / 2 - 5, y: player.y, width: 10, height: 20, speed: bulletSpeed };
                bullets.push(bullet);

                // Â¶ÇÊûúÊúâ‰∏âÈáçÂ∞ÑÂáªÔºåÊ∑ªÂä†È¢ùÂ§ñÁöÑÂ≠êÂºπ
                if (tripleShotChosen) {
                    bullets.push({ x: bullet.x - 15, y: bullet.y, width: 10, height: 20, speed: bulletSpeed });
                    bullets.push({ x: bullet.x + 15, y: bullet.y, width: 10, height: 20, speed: bulletSpeed });
                }
            }
        });

        // Êñ∞Â¢ûÁöÑÊõ¥Â§öÊåâÈíÆÂèäËèúÂçïÈÄªËæë
        const moreBtn = document.getElementById('moreBtn');
        const moreMenu = document.getElementById('moreMenu');
        const missMeBtn = document.getElementById('missMeBtn');

        moreBtn.addEventListener('click', () => {
            moreMenu.style.display = moreMenu.style.display === 'none'? 'block' : 'none';
        });

        const audio = new Audio('‰Ω†ÊÉ≥Êàë‰∫ÜÂêó.mp3');
        missMeBtn.addEventListener('click', () => {
            audio.play();
        });
    </script>
</body>

</html>
